# Gateway API Configuration for Organic Farm
# Replaces the deprecated NGINX Ingress
# Requires: Gateway API CRDs installed on cluster
# kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.2.0/standard-install.yaml

---
# HTTPRoute for routing traffic to services
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: farm-routes
  namespace: multi-farm
spec:
  parentRefs:
    - name: traefik-gateway
      namespace: traefik-system
      sectionName: https
  hostnames:
    - "of.kaayaka.in"
  rules:
    # Backend API routes - more specific path first
    - matches:
        - path:
            type: PathPrefix
            value: /api
      backendRefs:
        - name: backend-service
          port: 8000
      filters:
        - type: RequestHeaderModifier
          requestHeaderModifier:
            add:
              - name: X-Forwarded-Proto
                value: https
    # Frontend routes - catch-all
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: frontend-service
          port: 3000
